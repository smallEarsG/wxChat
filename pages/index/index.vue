<template>
    <view class="container">
        <!-- é¡¶éƒ¨æ ‡é¢˜åŒºåŸŸ -->
       

        <!-- å¡ç‰‡å¼æŒ‰é’®åŒºåŸŸ -->
        <view class="w-full max-w-4xl grid-container">
            <!-- ä¼ä¸šèŠå¤© -->
            <view class="card" @click="goToChat">
                <view class="icon-container bg-blue-100">
                    <text class="text-blue-600 text-2xl font-bold">ğŸ’¬</text>
                </view>
                <text class="card-title">ä¼ä¸šèŠå¤©</text>
                <text class="card-subtitle">å¿«é€Ÿç”Ÿæˆä¼ä¸šè‡ªå®šä¹‰èŠå¤©è®°å½•</text>
            </view>

            <!-- å¾®ä¿¡èŠå¤© -->
            <view class="card" @click="goToWxChat">
                <view class="icon-container bg-green-100">
                    <text class="text-green-600 text-2xl font-bold">ğŸ‘¥</text>
                </view>
                <text class="card-title">å¾®ä¿¡èŠå¤©</text>
                <text class="card-subtitle">å¿«é€Ÿç”Ÿæˆå¾®ä¿¡è‡ªå®šä¹‰èŠå¤©è®°å½•</text>
            </view>

            <!-- å¾®ä¿¡ç¾¤èŠ -->
            <view class="card" @click="goToWxChatGroup">
                <view class="icon-container bg-purple-100">
                    <text class="text-purple-600 text-2xl font-bold">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</text>
                </view>
                <text class="card-title">å¾®ä¿¡ç¾¤èŠ</text>
                <text class="card-subtitle">è‡ªå®šä¹‰ç¾¤èŠä¿¡æ¯ï¼Œæ¶æä¸“ç”¨</text>
            </view>

            <!-- ä¼ä¸šè½¬è´¦è®°å½• -->
            <view class="card" @click="goToRecords">
                <view class="icon-container bg-orange-100">
                    <text class="text-orange-600 text-2xl font-bold">ğŸ’¸</text>
                </view>
                <text class="card-title">ä¼ä¸šè½¬è´¦è®°å½•</text>
                <text class="card-subtitle">ä¼ä¸šæ”¶æ¬¾è½¬è´¦è®°å½•ï¼Œå¿«é€Ÿå»ºç«‹ä¿¡ä»»èƒŒä¹¦</text>
            </view>

            <!-- å¾®ä¿¡æ”¯ä»˜è®°å½• -->
            <view class="card" @click="goToWxChatPay">
                <view class="icon-container bg-red-100">
                    <text class="text-red-600 text-2xl font-bold">ğŸ’°</text>
                </view>
                <text class="card-title">å¾®ä¿¡æ”¯ä»˜è®°å½•</text>
                <text class="card-subtitle">å¿«é€Ÿç”Ÿæˆå¾®ä¿¡æ”¯ä»˜äº¤æ˜“å†å²æˆªå›¾ï¼Œè£…é€¼åˆ©å™¨</text>
            </view>

            <!-- è·å®¢åŠ©æ‰‹ -->
            <view class="card" @click="gotoGuset">
                <view class="icon-container bg-teal-100">
                    <text class="text-teal-600 text-2xl font-bold">ğŸ¯</text>
                </view>
                <text class="card-title">è·å®¢åŠ©æ‰‹</text>
                <text class="card-subtitle">æ‰‹åŠ¨ç¼–è¾‘è·å®¢æ•°é‡ï¼Œä½¿ç”¨æƒ…å†µ</text>
            </view>

            <!-- ä»˜æ¬¾è®°å½• -->
            <view class="card" @click="gotoCodePay">
                <view class="icon-container bg-indigo-100">
                    <text class="text-indigo-600 text-2xl font-bold">ğŸ“„</text>
                </view>
                <text class="card-title">å¾®ä¿¡ä»˜æ¬¾è®°å½•</text>
                <text class="card-subtitle">å¿«é€Ÿæ‰«æç”Ÿæˆä»˜æ¬¾è®°å½•ï¼Œè‡ªåŠ¨å½•å…¥è®¢å•å·ï¼Œä»¥å‡ä¹±çœŸï¼Œè‡ªå®šä¹‰é‡‘é¢å’Œæ—¶é—´</text>
            </view>
			<!-- å®šåˆ¶åŠŸèƒ½ -->
            <view class="card" >
                <view class="icon-container bg-pink-100">
                    <text class="text-pink-600 text-2xl font-bold">âš™ï¸</text>
                </view>
                <text class="card-title">æ”¯æŒå®šåˆ¶åŠŸèƒ½</text>
                <text class="card-subtitle">å¯é€šè¿‡ä¸ªäººä¸»é¡µè”ç³»ç®¡ç†å‘˜ä¸ªæ€§åŒ–å®šåˆ¶æ‚¨çš„åº”ç”¨åŠŸèƒ½ </text>
            </view>
        </view>
		<view class="w-full max-w-4xl mb-8">
		    <!-- <text class="title-text">åŠŸèƒ½ç®¡ç†ä¸­å¿ƒ </text> -->
		    <text class="subtitle-text">å…è´£å£°æ˜ï¼Œä»…ä¾›å¨±ä¹ï¼Œåˆ‡è«è¿æ³•</text>
		</view>
        <!-- å¼¹çª—ç»„ä»¶ -->
        <!-- <ProfileEditPopup ref="filePopup" @submit="onSubmit"></ProfileEditPopup> -->
     
        <pfePopup ref="wxChatGroupPopup" @submit="onSubmitWxGroup"></pfePopup>
    </view>
</template>

<script>
	import ProfileEditPopup from "../../components/ProfileEditPopup/ProfileEditPopup.vue"

	import {
		getUserInfo,
		updateUseFeature
	} from '@/api/index.js'
	import {
		isMemberExpired
	} from '@/utils/tool.js'
	export default {
		components: {
			ProfileEditPopup
		},
		data() {
			return {
				guestInfo: {},

			}
		},
		onShow() {
			const userId = uni.getStorageSync('userId')
			if (!userId) {
				uni.redirectTo({
					url: "/pages/login/login"
				})
			}
			// æŸ¥è¯¢ç”¨æˆ·ä½¿ç”¨æ¬¡æ•° ä»¥åŠæ˜¯å¦æ˜¯VIP
			this.getUserInfo(userId)
		},
		methods: {

			async getUserInfo(userId) {
				const res = await getUserInfo(userId)
				
				this.guestInfo = res.data
				console.log(res);
			},

			goToChat() {
				if (this.guestInfo.tryCount == 0) {
					if (isMemberExpired(this.guestInfo)) {
						// è¯•ç”¨æ¬¡æ•°ç”¨å®Œåå¼€å§‹éœ€è¦å……å€¼ä¼šå‘˜
						uni.showToast({
							title: 'ä½¿ç”¨æ¬¡æ•°å·²ç”¨å®Œè¯·å……å€¼ä¼šå‘˜',
							icon: 'none'
						});
						return
					}
				}
			updateUseFeature(this.guestInfo.id)
			uni.navigateTo({
				url:'/pages/chatList/chatList'
			})
			
			},
			goToWxChat(){
				if (this.guestInfo.tryCount == 0) {
					if (isMemberExpired(this.guestInfo)) {
						// è¯•ç”¨æ¬¡æ•°ç”¨å®Œåå¼€å§‹éœ€è¦å……å€¼ä¼šå‘˜
						uni.showToast({
							title: 'ä½¿ç”¨æ¬¡æ•°å·²ç”¨å®Œè¯·å……å€¼ä¼šå‘˜',
							icon: 'none'
						});
						return
					}
				}
				updateUseFeature(this.guestInfo.id)
				uni.navigateTo({
					url:'/pages/wxChatList/wxChatList'
				})
				// this.$refs.wxChatPopup.open()
			},
			goToWxChatGroup(){
				if (this.guestInfo.tryCount == 0) {
					if (isMemberExpired(this.guestInfo)) {
						// è¯•ç”¨æ¬¡æ•°ç”¨å®Œåå¼€å§‹éœ€è¦å……å€¼ä¼šå‘˜
						uni.showToast({
							title: 'ä½¿ç”¨æ¬¡æ•°å·²ç”¨å®Œè¯·å……å€¼ä¼šå‘˜',
							icon: 'none'
						});
						return
					}
				}
				this.$refs.wxChatGroupPopup.open()
			},
			onSubmitWxGroup(data){
				if (this.guestInfo.tryCount == 0) {
					if (isMemberExpired(this.guestInfo)) {
						// è¯•ç”¨æ¬¡æ•°ç”¨å®Œåå¼€å§‹éœ€è¦å……å€¼ä¼šå‘˜
						uni.showToast({
							title: 'ä½¿ç”¨æ¬¡æ•°å·²ç”¨å®Œè¯·å……å€¼ä¼šå‘˜',
							icon: 'none'
						});
						return
					}
				}
			
				updateUseFeature(this.guestInfo.id)
				uni.navigateTo({
					url: '/pages/wxChatGroup/wxChatGroup?guestInfo=' + encodeURIComponent(JSON.stringify(data))
				});
			},
			
			onSubmit(data) {
				updateUseFeature(this.guestInfo.id)
				uni.navigateTo({
					url: '/pages/chat/chat?guestInfo=' + encodeURIComponent(JSON.stringify(data))
				});
			},
			// è·³è½¬åˆ°è½¬è´¦è®°å½•é¡µé¢
			goToRecords() {
				if (this.guestInfo.tryCount == 0) {
					console.log(isMemberExpired(this.guestInfo));
					if (isMemberExpired(this.guestInfo)) {
						// è¯•ç”¨æ¬¡æ•°ç”¨å®Œåå¼€å§‹éœ€è¦å……å€¼ä¼šå‘˜
						uni.showToast({
							title: 'ä½¿ç”¨æ¬¡æ•°å·²ç”¨å®Œè¯·å……å€¼ä¼šå‘˜',
							icon: 'none'
						});
						return
					}
				}
				// å‡å°‘ä½¿ç”¨æ¬¡æ•°
				updateUseFeature(this.guestInfo.id)
				uni.navigateTo({
					url: '/pages/records/records'
				});
			},
			goToWxChatPay() {

				if (this.guestInfo.tryCount == 0) {
					console.log(isMemberExpired(this.guestInfo));
					if (isMemberExpired(this.guestInfo)) {
						// è¯•ç”¨æ¬¡æ•°ç”¨å®Œåå¼€å§‹éœ€è¦å……å€¼ä¼šå‘˜
						uni.showToast({
							title: 'ä½¿ç”¨æ¬¡æ•°å·²ç”¨å®Œè¯·å……å€¼ä¼šå‘˜',
							icon: 'none'
						});
						return
					}
				}
				// å‡å°‘ä½¿ç”¨æ¬¡æ•°
				updateUseFeature(this.guestInfo.id)

				uni.navigateTo({
					url: '/pages/weChatPay/weChatPay'
				});
			},
			
			gotoGuset(){
				uni.navigateTo({
					url: '/pages/getGuset/getGuset'
				});
			},
			gotoCodePay(){
				if (this.guestInfo.tryCount == 0) {
					if (isMemberExpired(this.guestInfo)) {
						// è¯•ç”¨æ¬¡æ•°ç”¨å®Œåå¼€å§‹éœ€è¦å……å€¼ä¼šå‘˜
						uni.showToast({
							title: 'ä½¿ç”¨æ¬¡æ•°å·²ç”¨å®Œè¯·å……å€¼ä¼šå‘˜',
							icon: 'none'
						});
						return
					}
				}
				updateUseFeature(this.guestInfo.id)
				uni.navigateTo({
					url: '/pages/codePay/codePay'
				});
			}
		}
	};
</script>

<style>
/* åŸºç¡€æ ·å¼ */
.container {
    background-color: #f9fafb;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding-top: 40rpx;
    padding-bottom: 100rpx;
    padding-left: 20rpx;
    padding-right: 20rpx;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
}

/* æ–‡æœ¬æ ·å¼ */
.title-text {
    font-size: clamp(75rpx, 3vw, 125rpx);
    font-weight: bold;
    color: #1f2937;
}

.subtitle-text {
    color: #6b7280;
    margin-top: 35rpx;
    display: block;
    font-size: 35rpx;
	margin-bottom: 35rpx;
}

/* ç½‘æ ¼å®¹å™¨ */
.grid-container {
    width: 100%;
    max-width: 2000rpx;
    display: grid;
    grid-template-columns: repeat(1, 1fr);
    gap: 30rpx;
}

/* å“åº”å¼è®¾è®¡ */
@media (min-width: 640rpx) {
    .grid-container {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (min-width: 1024rpx) {
    .grid-container {
        grid-template-columns: repeat(3, 1fr);
    }
}

/* å¡ç‰‡æ ·å¼ */
.card {
    background-color: white;
    border-radius: 30rpx;
    box-shadow: 0 10rpx 20rpx rgba(0, 0, 0, 0.05);
    padding: 30rpx;
    cursor: pointer;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
    transform: translateY(-10rpx);
    box-shadow: 0 20rpx 30rpx rgba(0, 0, 0, 0.1);
}

/* å›¾æ ‡å®¹å™¨ */
.icon-container {
    width: 70rpx;
    height: 70rpx;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 20rpx;
    transition: background-color 0.3s ease;
}

.card:hover .icon-container.bg-blue-100 {
    background-color: #dbeafe;
}

.card:hover .icon-container.bg-green-100 {
    background-color: #dcfce7;
}

.card:hover .icon-container.bg-purple-100 {
    background-color: #ede9fe;
}

.card:hover .icon-container.bg-orange-100 {
    background-color: #ffedd5;
}

.card:hover .icon-container.bg-red-100 {
    background-color: #fee2e2;
}

.card:hover .icon-container.bg-teal-100 {
    background-color: #ccfbf1;
}

.card:hover .icon-container.bg-indigo-100 {
    background-color: #e0e7ff;
}

.card:hover .icon-container.bg-pink-100 {
    background-color: #fce7f3;
}

/* å¡ç‰‡æ–‡æœ¬ */
.card-title {
    display: block;
    font-size: 40rpx;
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 10rpx;
}

.card-subtitle {
    color: #6b7280;
    font-size: 30rpx;
}

/* æŒ‰é’®æ ·å¼ */
.btn {
    background: linear-gradient(135deg, #007AFF 0%, #0051cc 100%);
    border: none;
    border-radius: 25rpx;
    padding: 25rpx;
    font-weight: 500;
    transition: all 0.2s ease;
    box-shadow: 0 20rpx 30rpx -5rpx rgba(0, 122, 255, 0.2);
    color: white;
    text-align: center;
}

.btn:hover {
    background: linear-gradient(135deg, #0066cc 0%, #004080 100%);
    box-shadow: 0 50rpx 75rpx -15rpx rgba(0, 122, 255, 0.3);
}
</style>    